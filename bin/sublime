#!/usr/bin/env sh
#
# Open sublime

SUBLIME=subl

# No parameters given, just open sublime
if [ $# -eq 0 ]; then
    exec $SUBLIME
    exit $?
fi

if [ -d $1 ] && [ $# -eq 1 ]; then
    sublime_project_files=($(find "$1" -maxdepth 1 -iname "*.sublime-project" -print))

    # If multiple project files are found, just open 1
    if [ ${#sublime_project_files[@]} -gt 1 ]; then
        echo >&2 "Multiple .sublime-project files found in $(cd $1 && pwd). Opening the first"
        sublime_project_files=(${sublime_project_files[0]})
    fi

    if [ ${#sublime_project_files[@]} -eq 1 ]; then
        exec $SUBLIME $sublime_project_files
        exit $?
    fi
fi

exec $SUBLIME $@
